<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADIVANA</title>
    <link rel="icon" href="images/qsjvkfkf.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Alegreya+Sans:ital,wght@0,500;1,500&family=Roboto+Slab&family=Satisfy&display=swap" rel="stylesheet">
    <style>

*{
    padding:0;
    margin:0;
    box-sizing:border-box;
    font-family: 'Roboto Slab', serif;
    list-style:none;
    text-decoration:none;
}

        /* Container styles */
        .container {
            margin-top: 20px;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Table styles */
        .table-primary {
            width: 90%;
            border: 2px solid transparent;
            left:5%;
            text-align: center;
            
            
        }
        th.glass, td.glass {
    padding:12px;
    border: 1px solid transparent;

  }
       
    
        #Addbtn{
            color: yellow;
            position: relative;
            left: 85%;
        }
        /* .btn btn-primary my-2{
            align-items: center;
        } */
        .labs{
            display: inline-block;
            width: 100px;
        }
        .glass{
    top:30%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
    position: absolute;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 2px;
    border:1px solid rgba(255, 255, 255, 0.18);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  }
  header{
    position:fixed;
    right:0;
    top:0;
    z-index:1000;
    width:100%;
    display:flex;
    align-items: center;
    justify-content: space-between;
    padding:33px 9%;
    background:transparent;
}
.logo{
    font-size:30px;
    font-weight:700;
    color:#ffcb9a;

}
.navlist{
    display:flex;
}
.navlist a{
    text-decoration: none;
    color:#ffcb9a;
    margin-left:60px;
    font-size:15px;
    font-weight:600;
    border-bottom:2px solid transparent;
    transition: all .55s ease;
}
.navlist a:hover,
.navlist a.active{
    border-bottom:2px solid white;
}
#menu-icon{
    color:white;
    font-size:35px;
    z-index:1001;
    cursor:pointer;
    display:none;
}
.hero{
    margin-top:-8%;
    height:100%;
    width:100%;
    min-height:150vh;
    position:relative;
    display:grid;
    grid-template-columns:repeat(2,1fr);
    align-items: center;
    gap:2rem;
    background:linear-gradient(109.6deg, rgb(36, 45, 57) 11.2%, rgb(16, 37, 60) 51.2%, rgb(0, 0, 0) 98.6%)  repeat;
}
section{
    padding:0 19%;
}
.btn{
    top:-108%;
    padding:10px;
    width:35%;
    position: relative;
    font-size: 16px;
    border-radius: 30px;
    border:none;
    color:#d1e8e2;
    background-color:#434b5b;
}

.btn a{
    text-decoration: none;
    color:#d1e8e2;
}
.user-greeting{
    font-size:small;
    color: #d1e8e2;
    font-weight: bold;
}
.option{
    left:30%;
    padding:10px;
    width:35%;
    position: relative;
    font-size: 16px;
    border-radius: 30px;
    border:none;
    color:#d1e8e2;
    background-color:#434b5b;
}
    </style>
</head>

<body>
    <section class="hero"> 
        <header>
            <a href="index.html" class="logo" style="text-decoration: none; color:#ffcb9a"><i>ADIVANA</i></a>
            <ul class="navlist">
                <h4 id="greet" class="user-greeting"></h4>
                <li><a href="new.html">Home</a></li>
                <li><a href="batch_details.html"  >Batch</a></li>
                <li><a href="student_details.html" class="active">Student</a></li>
                <li><a href="teach_details.html">Teacher</a></li>
            </ul>
            <div class="bx bx-menu" id="menu-icon"></div>
        </header>
        <p style=" color:#ffcb9a; font-size:40px">Students Details</p>
        <select id="batchFilter" class="option">
            <option value="All">All Batches</option>
          </select>
        <button type="button" class="btn" style="left:200%"><a href="student_add.html">Add</a></button>

        
    <div class="container mt-3"> 
        <table class="table-primary glass" style="color:white">
            <thead>
                <th>Serial No.</th>
                <th>Name</th>
                <th>Roll No.</th>
                <th>Batch Name</th>
                <th>Section</th>
                <th>Gender</th>
                <th>Control Center</th>
            </thead>
            <tbody id="tbody1">
                
            </tbody>
            
        </table>

    </div>

  <!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Control Panel</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <label class="labs">Name:</label>
            <input type="text" id="NameMod"><br>
            <label class="labs">RollNo:</label>
            <input type="text" id="RollMod"><br>
            <label class="labs">Batch Name:</label>
            <input type="text" id="BnMod"><br>
            <label class="labs">Section:</label>
            <input type="text" id="SecMod"><br>
            <label class="labs">Gender:</label>
            <input type="text" id="GenMod"><br>

        </div>
        <div class="modal-footer">
          <!-- <button id="AddModBtn" type="button" class="btn btn-primary" onclick="AddStd()">Add New Record</button> -->
          <button id="UpdModBtn" type="button" class="btn btn-success" onclick="UpdStd()">Update Record</button>
          <button id="DelModBtn" type="button" class="btn btn-danger" onclick="DelStd()">Delete Record</button>
        </div>
      </div>
    </div>
  </div>

    <!-- <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js"></script> -->

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

</section>   

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script type="module">
        
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-analytics.js";
        import{ getDatabase,set,ref,get,update,remove} from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyAE6OhXIxNQZ1csVGZj1-KLX8kTQkXmelE",
          authDomain: "ar-page.firebaseapp.com",
          databaseURL: "https://ar-page-default-rtdb.firebaseio.com",
          projectId: "ar-page",
          storageBucket: "ar-page.appspot.com",
          messagingSenderId: "114042234965",
          appId: "1:114042234965:web:abb4da8b18d98b0d4fccdc",
          measurementId: "G-5HJP706T9M"
        };
      
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        var stdNo;
        var batchFilter = document.getElementById("batchFilter");
        var tableBody = document.getElementById("tbody1");
        var stdList = [];

        function SelectAllData() {
            document.getElementById('tbody1').innerHTML="";
            stdNo=0;
    get(ref(database, 'student')).then((snapshot) => {
        if (snapshot.exists()) {
            snapshot.forEach((childSnapshot) => {
                var name = childSnapshot.val().NameOfStudent;
                var roll = childSnapshot.val().RollNo;
                var bn = childSnapshot.val().BatchName;
                var sec = childSnapshot.val().Section;
                var gen = childSnapshot.val().Gender;

                AddItemsToTable(name, roll, bn, sec, gen);
            });
        } else {
            console.log("No data available");
        }
    }).catch((error) => {
        console.error("Error getting data: " + error);
    });
}

        window.onload=SelectAllData;

        var stdList=[];
        function AddItemsToTable(name,roll,bn,sec,gen){
            var tbody=document.getElementById('tbody1');
            var tr = document.createElement('tr');
            var td1 = document.createElement('td');
            var td2 = document.createElement('td');
            var td3 = document.createElement('td');
            var td4 = document.createElement('td');
            var td5 = document.createElement('td');
            var td6 = document.createElement('td');
            
            stdList.push([name,roll,bn,sec,gen]);
            td1.innerHTML=++stdNo;
            td2.innerHTML=name;
            td3.innerHTML=roll;
            td4.innerHTML=bn;
            td5.innerHTML=sec;
            td6.innerHTML=gen;
            

            tr.appendChild(td1); 
            tr.appendChild(td2); 
            tr.appendChild(td3); 
            tr.appendChild(td4); 
            tr.appendChild(td5); 
            tr.appendChild(td6);

            var ControlDiv=document.createElement("div");
            // ControlDiv.innerHTML='<button type="button" class="btn btn-primary my-2" data-toggle="modal" data-target="#exampleModalCenter" onclick="FillTboxes(null)">Add New Record</button>'
            ControlDiv.innerHTML+='<button type="button" class="btn btn-primary my-2 ml-2" data-toggle="modal" data-target="#exampleModalCenter" onclick="FillTboxes('+stdNo+')">Edit</button>'

            tr.appendChild(ControlDiv);
            tbody.appendChild(tr);
        }

        var ModName=document.getElementById('NameMod');
        var ModRoll=document.getElementById('RollMod');
        var ModBatch=document.getElementById('BnMod');
        var ModSec=document.getElementById('SecMod');
        var ModGen=document.getElementById('GenMod');

        var BTNmodAdd=document.getElementById('AddModBtn');
        var BTNmodUpd=document.getElementById('UpdModBtn');
        var BTNmodDel=document.getElementById('DelModBtn');


//         function AddStd() {
//     const rollNo = ModRoll.value;

//     set(ref(database, 'student/' + rollNo), {
//         NameOfStudent: ModName.value,
//         RollNo: rollNo,
//         BatchName: ModBatch.value,
//         Section: ModSec.value,
//         Gender: ModGen.value
//     })
//     .then(() => {
//         alert("Record was added");
//         SelectAllData();
//         $("#exampleModalCenter").modal('hide');
//     })
//     .catch((error) => {
//         alert("Error: Record was not added");
//         console.error(error);
//     });
// }
async function populateBatchFilter() {
            const batchFilter = document.getElementById("batchFilter");
            const database = getDatabase(app);

            // Fetch batch names from Realtime Database
            const snapshot = await get(ref(database, "student"));
            const batchNames = new Set();

            if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                    const batchName = childSnapshot.val().BatchName;
                    batchNames.add(batchName);
                });
            }

            // Clear existing options and add new ones
            batchFilter.innerHTML = '<option value="All">All Batches</option>';
            batchNames.forEach((batchName) => {
                const option = document.createElement("option");
                option.value = batchName;
                option.textContent = batchName;
                batchFilter.appendChild(option);
            });
        }

        batchFilter.addEventListener("change", function () {
  const selectedBatch = batchFilter.value;

  // Get all table rows
  const rows = document.querySelectorAll("#tbody1 tr");

  if (selectedBatch === "All") {
    // Show all rows when "All Batches" is selected
    rows.forEach((row) => {
      row.style.display = "table-row";
    });
  } else {
    // Hide rows that do not match the selected batch
    rows.forEach((row) => {
      const batchCell = row.querySelector("td:nth-child(4)").textContent;
      if (batchCell === selectedBatch) {
        row.style.display = "table-row";
      } else {
        row.style.display = "none";
      }
    });
  }
});

        // Call the function to populate the Batches filter on page load
        populateBatchFilter();


        async function UpdStd() {
    const rollNo = ModRoll.value;
    const updates = {
        NameOfStudent: ModName.value,
        RollNo: rollNo,
        BatchName: ModBatch.value,
        Section: ModSec.value,
        Gender: ModGen.value
    };

    try {
        await update(ref(database, 'student/' + rollNo), updates);
        Swal.fire({
            title: 'Success',
            text: 'Record updated successfully!',
            icon: 'success'
        });
        SelectAllData();
        $("#exampleModalCenter").modal('hide');
    } catch (error) {
        Swal.fire({
            title: 'Error',
            text: 'Record not updated. Error: ' + error,
            icon: 'error'
        });
    }
}

async function DelStd() {
    const rollNo = ModRoll.value;
    const studentRef = ref(database, 'student/' + rollNo);

    try {
        await remove(studentRef);
        Swal.fire({
            title: 'Success',
            text: 'Record deleted successfully!',
            icon: 'success'
        });
        SelectAllData();
        $("#exampleModalCenter").modal('hide');
    } catch (error) {
        Swal.fire({
            title: 'Error',
            text: 'Record not deleted. Error: ' + error,
            icon: 'error'
        });
    }
}

        window.FillTboxes=(index)=>{
            if(index==null){
                ModName.value="";
                ModRoll.value="";
                ModBatch.value="";
                ModSec.value="";
                ModGen.value="";
                ModRoll.disabled=false;
                // BTNmodAdd.style.display='inline-block';
                // BTNmodUpd.style.display='none';
                // BTNmodDel.style.display='none';

            }
            else{
                --index;
                ModName.value=stdList[index][0];
                ModRoll.value=stdList[index][1];
                ModBatch.value=stdList[index][2];
                ModSec.value=stdList[index][3];
                ModGen.value=stdList[index][4];
                ModRoll.disabled=true;
                // BTNmodAdd.style.display='none';
                // BTNmodUpd.style.display='inline-block';
                // BTNmodDel.style.display='inline-block';

            }
            $('#exampleModalCenter').modal('show');
             
        }

        // window.AddStd = AddStd;
        window.UpdStd = UpdStd;
        window.DelStd = DelStd;
      
        let menu=document.querySelector('#menu-icon');
let navlist=document.querySelector('.navlist');

menu.onclick=()=>{
    menu.classList.toggle('bx-x');
    navlist.classList.toggle('open');
};
let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
    let UserInfo = JSON.parse(sessionStorage.getItem("user-info"));

    let GreetHead = document.getElementById('greet');
    let Navlist = document.getElementById('navlist');
    let SignoutBtn; // declare SignoutBtn outside functions to access it globally
    let CreateAccountLink; // declare CreateAccountLink outside functions to access it globally

    let Signout = () => {
        sessionStorage.removeItem("user-creds");
        sessionStorage.removeItem("user-info");
        GreetHead.innerText = '';
        if (SignoutBtn) {
            SignoutBtn.style.display = 'none'; // hide the sign-out link
        }
        if (CreateAccountLink) {
            CreateAccountLink.innerText = 'Login';
            CreateAccountLink.href = '1.html';
            CreateAccountLink.style.display = 'block'; // display the create account link
            CreateAccountLink.classList.add('navlist-link'); // add the appropriate class for styling
        }
    }

    let CheckCred = () => {
        if (UserCreds) {
            GreetHead.innerText = `Hii ${UserInfo.firstname} ${UserInfo.lastname}!  `;
            const navlistItem = document.createElement('li');

            // Sign out link
            SignoutBtn = document.createElement('a');
            SignoutBtn.href = 'index.html'; // replace with the appropriate link
            SignoutBtn.innerText = 'Sign Out';
            SignoutBtn.onclick = Signout;
            SignoutBtn.classList.add('navlist-link'); // add the appropriate class for styling
            navlistItem.appendChild(SignoutBtn);

            // Create account link
            CreateAccountLink = document.createElement('a');
            CreateAccountLink.style.display = 'none'; // hide the link by default
            CreateAccountLink.classList.add('navlist-link'); // add the appropriate class for styling
            navlist.appendChild(navlistItem);
            navlist.appendChild(CreateAccountLink);
        } else {
            CreateAccountLink = document.createElement('a');
            CreateAccountLink.href = '1.html'; // Replace with the appropriate link
            CreateAccountLink.innerText = 'Login';
            CreateAccountLink.classList.add('navlist-link'); // add the appropriate class for styling
            navlist.appendChild(CreateAccountLink);
        }
    };

    window.addEventListener('load', CheckCred);

    </script>

    </body>
</html>